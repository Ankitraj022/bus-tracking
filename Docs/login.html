<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - SmartBus Tracker</title>
     <script src="https://cdn.tailwindcss.com"></script>
   <script src="chatbot.js"></script>
   <script src="languages.js"></script>
     <style>
     .login-bg {
       background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), 
                   url('https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2069&q=80'),
                   linear-gradient(135deg, #1e3a8a 0%, #3b82f6 25%, #06b6d4 50%, #0891b2 75%, #0e7490 100%);
       background-size: cover, cover, 100% 100%;
       background-position: center, center, center;
       background-repeat: no-repeat, no-repeat, no-repeat;
       background-attachment: fixed, fixed, fixed;
     }
     .form-input:focus {
       box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
     }
     .error-message {
       animation: shake 0.5s ease-in-out;
     }
     @keyframes shake {
       0%, 100% { transform: translateX(0); }
       25% { transform: translateX(-5px); }
       75% { transform: translateX(5px); }
     }
     .glass-effect {
       background: rgba(255, 255, 255, 0.95);
       backdrop-filter: blur(10px);
       border: 1px solid rgba(255, 255, 255, 0.2);
       position: relative;
       overflow: hidden;
     }
     .glass-effect::before {
       content: '';
       position: absolute;
       top: -50%;
       left: -50%;
       width: 200%;
       height: 200%;
       background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
       animation: float 6s ease-in-out infinite;
       pointer-events: none;
     }
     @keyframes float {
       0%, 100% { transform: translateY(0px) rotate(0deg); }
       50% { transform: translateY(-20px) rotate(180deg); }
     }
     .bus-pattern {
       position: absolute;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       opacity: 0.05;
       background-image: 
         radial-gradient(circle at 20% 20%, #3b82f6 1px, transparent 1px),
         radial-gradient(circle at 80% 80%, #06b6d4 1px, transparent 1px),
         radial-gradient(circle at 40% 60%, #0891b2 1px, transparent 1px);
       background-size: 50px 50px, 30px 30px, 40px 40px;
       pointer-events: none;
     }
     .animate-slide-up {
       animation: slideUp 0.3s ease-out;
     }
     @keyframes slideUp {
       from {
         opacity: 0;
         transform: translateY(20px);
       }
       to {
         opacity: 1;
         transform: translateY(0);
       }
     }
   </style>
</head>
<body class="login-bg min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8">
    <!-- Logo and Title -->
    <div class="text-center">
      <div class="mx-auto h-16 w-16 bg-white rounded-full flex items-center justify-center shadow-lg">
        <span class="text-3xl">ðŸšŒ</span>
      </div>
             <h2 class="mt-6 text-3xl font-extrabold text-white" data-translate="login_title">
         SmartBus Tracker
       </h2>
       <p class="mt-2 text-sm text-gray-200" data-translate="login_subtitle">
         Sign in to your account
       </p>
    </div>

         <!-- Login Form -->
     <div class="glass-effect rounded-lg shadow-xl p-8">
       <div class="bus-pattern"></div>
      <form id="loginForm" class="space-y-6">
        <!-- Email Field -->
        <div>
                     <label for="email" class="block text-sm font-medium text-gray-700" data-translate="login_email">
             Username
           </label>
          <div class="mt-1">
            <input id="email" name="email" type="text" required 
                   class="form-input appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                   placeholder="Enter your username">
          </div>
        </div>

        <!-- Password Field -->
        <div>
                     <label for="password" class="block text-sm font-medium text-gray-700" data-translate="login_password">
             Password
           </label>
          <div class="mt-1">
            <input id="password" name="password" type="password" required 
                   class="form-input appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                   placeholder="Enter your password">
          </div>
        </div>

        <!-- Remember Me and Forgot Password -->
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <input id="remember-me" name="remember-me" type="checkbox" 
                   class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
            <label for="remember-me" class="ml-2 block text-sm text-gray-900">
              Remember me
            </label>
          </div>

          <div class="text-sm">
            <a href="#" class="font-medium text-blue-600 hover:text-blue-500">
              Forgot your password?
            </a>
          </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden">
          <div class="bg-red-50 border border-red-200 rounded-md p-4 error-message">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <p id="errorText" class="text-sm text-red-800"></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Login Button -->
        <div>
          <button type="submit" id="loginBtn"
                  class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                         <span id="loginBtnText" data-translate="login_button">Sign in</span>
            <span id="loginBtnSpinner" class="hidden">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>
        </div>

        <!-- Register Link -->
        <div class="text-center">
                     <p class="text-sm text-gray-600">
             <span data-translate="login_no_account">Don't have an account?</span>
             <a href="#" onclick="showRegisterForm()" class="font-medium text-blue-600 hover:text-blue-500" data-translate="login_signup">
               Sign up here
             </a>
           </p>
        </div>
      </form>

      <!-- Register Form (Hidden by default) -->
      <form id="registerForm" class="space-y-6 hidden">
        <!-- Name Field -->
        <div>
                     <label for="regName" class="block text-sm font-medium text-gray-700" data-translate="register_title">
             Full Name
           </label>
          <div class="mt-1">
            <input id="regName" name="name" type="text" required 
                   class="form-input appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                   placeholder="Enter your full name">
          </div>
        </div>

        <!-- Email Field -->
        <div>
          <label for="regEmail" class="block text-sm font-medium text-gray-700">
            Email address
          </label>
          <div class="mt-1">
            <input id="regEmail" name="email" type="email" required 
                   class="form-input appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                   placeholder="Enter your email">
          </div>
        </div>

        <!-- Password Field -->
        <div>
          <label for="regPassword" class="block text-sm font-medium text-gray-700">
            Password
          </label>
          <div class="mt-1">
            <input id="regPassword" name="password" type="password" required 
                   class="form-input appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                   placeholder="Create a password">
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div>
          <label for="regConfirmPassword" class="block text-sm font-medium text-gray-700">
            Confirm Password
          </label>
          <div class="mt-1">
            <input id="regConfirmPassword" name="confirmPassword" type="password" required 
                   class="form-input appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                   placeholder="Confirm your password">
          </div>
        </div>

        <!-- Register Button -->
        <div>
          <button type="submit" id="registerBtn"
                  class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                         <span id="registerBtnText" data-translate="register_button">Create Account</span>
            <span id="registerBtnSpinner" class="hidden">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>
        </div>

        <!-- Login Link -->
        <div class="text-center">
                     <p class="text-sm text-gray-600">
             <span data-translate="register_has_account">Already have an account?</span>
             <a href="#" onclick="showLoginForm()" class="font-medium text-blue-600 hover:text-blue-500" data-translate="register_signin">
               Sign in here
             </a>
           </p>
        </div>
      </form>
    </div>

         <!-- Demo Credentials -->
     <div class="glass-effect rounded-lg p-4 text-center">
       <div class="bus-pattern"></div>
             <p class="text-sm text-gray-800 mb-2 font-semibold" data-translate="demo_credentials">Demo Credentials:</p>
       <p class="text-xs text-gray-700">Email: admin@smartbus.com</p>
       <p class="text-xs text-gray-700">Password: admin123</p>
    </div>
  </div>

  <script>
    const SERVER_URL = 'http://localhost:3000';

    // Show/Hide forms
    function showRegisterForm() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('registerForm').classList.remove('hidden');
      hideError();
    }

    function showLoginForm() {
      document.getElementById('registerForm').classList.add('hidden');
      document.getElementById('loginForm').classList.remove('hidden');
      hideError();
    }

    // Error handling
    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      const errorText = document.getElementById('errorText');
      errorText.textContent = message;
      errorDiv.classList.remove('hidden');
    }

    function hideError() {
      document.getElementById('errorMessage').classList.add('hidden');
    }

    // Loading states
    function setLoading(buttonId, textId, spinnerId, isLoading) {
      const button = document.getElementById(buttonId);
      const text = document.getElementById(textId);
      const spinner = document.getElementById(spinnerId);
      
      if (isLoading) {
        button.disabled = true;
        text.classList.add('hidden');
        spinner.classList.remove('hidden');
      } else {
        button.disabled = false;
        text.classList.remove('hidden');
        spinner.classList.add('hidden');
      }
    }

    // Login form submission
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      hideError();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const rememberMe = document.getElementById('remember-me').checked;

      setLoading('loginBtn', 'loginBtnText', 'loginBtnSpinner', true);

      try {
        const response = await fetch('../api/auth.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username: email, password: password })
        });

        const data = await response.json();

        if (response.ok) {
          // Store user data
          localStorage.setItem('user', JSON.stringify(data.user));
          localStorage.setItem('session_id', data.session_id);
          
          // Redirect to admin dashboard
          window.location.href = '../admin/dashboard.php';
        } else {
          showError(data.error || 'Login failed. Please try again.');
        }
      } catch (error) {
        console.error('Login error:', error);
        showError('Network error. Please check your connection.');
      } finally {
        setLoading('loginBtn', 'loginBtnText', 'loginBtnSpinner', false);
      }
    });

    // Register form submission
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      hideError();
      
      const name = document.getElementById('regName').value;
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const confirmPassword = document.getElementById('regConfirmPassword').value;

      // Validation
      if (password !== confirmPassword) {
        showError('Passwords do not match.');
        return;
      }

      if (password.length < 6) {
        showError('Password must be at least 6 characters long.');
        return;
      }

      setLoading('registerBtn', 'registerBtnText', 'registerBtnSpinner', true);

      try {
        const response = await fetch(`${SERVER_URL}/api/auth/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, email, password })
        });

        const data = await response.json();

        if (response.ok) {
          // Show success message and switch to login
          alert('Registration successful! Please sign in.');
          showLoginForm();
          document.getElementById('email').value = email;
        } else {
          showError(data.message || 'Registration failed. Please try again.');
        }
      } catch (error) {
        console.error('Registration error:', error);
        showError('Network error. Please check your connection.');
      } finally {
        setLoading('registerBtn', 'registerBtnText', 'registerBtnSpinner', false);
      }
    });

    // Check if user is already logged in
    window.onload = function() {
      const token = localStorage.getItem('authToken');
      if (token) {
        // Redirect to main page if already logged in
        window.location.href = '/';
      }
    };
  </script>
</body>
</html>
